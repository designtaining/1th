<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- ✅ GSAP Pin + p3(메시지→70% 이미지→후속 메시지) + p4 아웃트로: 전체 프레임 80vw×80vw 축소 + 1024↓ 100vh  -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --panelMaxW: 1280px;
        }

        /* 트리거(핀)는 섹션에 걸고, 실제 시각적 크기는 pinFrame으로 조절 */
        #pinShowcase {
            width: 100vw;
            /* 뷰포트 기준 */
            margin-left: calc(50% - 50vw);
            /* 부모 고정폭에서 탈출 */
            margin-right: calc(50% - 50vw);
            height: 100vh;
            /* 기본은 화면 꽉 차게 */
            position: relative;
            overflow: hidden;
            color: #fff;
        }

        /* ✅ 축소되는 실제 프레임 */
        #pinShowcase .pinFrame {
            position: absolute;
            inset: 0;
            margin: auto;
            /* 항상 중앙 */
            width: 100vw;
            height: 100vh;
            border-radius: 0;
            overflow: hidden;
            will-change: width, height, border-radius, transform;
        }

        #pinShowcase .stage {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #pinShowcase .panel {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            opacity: 0;
            transform: translateY(40px);
            will-change: transform, opacity;
        }

        #pinShowcase,
        #pinShowcase .pinFrame,
        #pinShowcase .panel {
            width: 100vw !important;
            max-width: 100vw !important;
        }

        /* 겹침 순서 */
        .p1 {
            z-index: 1;
        }

        .p2 {
            z-index: 2;
        }

        .p3 {
            z-index: 3;
        }

        .p4 {
            z-index: 4;
        }

        /* 배경 (p1은 heroBox가 배경 역할) */
        .p2 {
            background: linear-gradient(180deg, #2e50e2, #1428A0);
        }

        .p3 {
            background: linear-gradient(180deg, #0f0f0f, #000);
        }

        .p4 {
            background: linear-gradient(180deg, #333, #111);
        }

        /* p1 hero */
        .p1 {
            position: relative;
        }

        .p1 .centerOverlay {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 2;
        }

        .p1 .centerOverlay .inner {
            pointer-events: auto;
        }

        .p1 .heroBox {
            width: min(80vw);
            height: clamp(56vh, 80vmin, 960px);
            /* 화면비 따라 유연 */
            border-radius: 24px;
            background: url(https://ncryk7.mycafe24.com/package2.png) center/cover no-repeat;
            display: grid;
            place-items: center;
            will-change: width, height, border-radius;
            z-index: 1;
        }

        /* 공통 텍스트 */
        .inner {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 24px;
            max-width: 960px;
        }

        .title {
            font-size: 56px;
            line-height: 1.15;
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 16px;
            z-index: 2;
        }

        .desc {
            font-size: 18px;
            line-height: 1.6;
            opacity: 0.9;
        }

        /* p2 그리드 */
        .panel_box_wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: min(var(--panelMaxW), 92vw);
        }

        .panel_box {
            border-radius: 32px;
            transform: translateZ(0);
        }

        .panel_box>img {
            border-radius: 32px;
            display: block;
        }

        .panel_box,
        .panel_box>img {
            width: clamp(140px, 22vw, 300px);
        }

        /* p3 확장 요소 */
        .p3 .featureImgWrap {
            width: min(60%, 900px);
            /* 요청: 70% */
            max-width: var(--panelMaxW);
            margin-top: 24px;
            transform: translateY(60px);
            opacity: 0;
        }

        .p3 .featureImgWrap img {
            width: 100%;
            display: block;
            border-radius: 24px;
        }

        .p3 .msg2 {
            margin-top: 24px;
            opacity: 0;
            transform: translateY(30px);
        }

        /* ✅ 1024px 이하: 모두 100vh로 꽉 차게 */
        @media (max-width: 1024px) {

            #pinShowcase,
            #pinShowcase .pinFrame,
            #pinShowcase .stage,
            #pinShowcase .panel {
                height: 100svh;
                /* 주소창 제외 실제 화면 */
            }

            .title {
                font-size: 40px;
            }

            .p1 .heroBox {
                height: 100svh;
                border-radius: 0;
                width: 100vw;
            }

            /* 모바일에서 풀스크린 히어로 */
            .panel_box,
            .panel_box>img {
                width: 44vw;
            }
        }

        @media (max-width: 768px) {
            .title {
                font-size: 32px;
            }

            .desc {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>

    <section id="pinShowcase">
        <!-- ✅ 축소 대상 프레임 -->
        <div class="pinFrame">
            <div class="stage">
                <!-- p1 -->
                <div class="panel p1">
                    <div class="heroBox" aria-hidden="true"></div>
                    <div class="centerOverlay">
                        <div class="inner">
                            <p class="title">Step 1 — 인트로</p>
                        </div>
                    </div>
                </div>

                <!-- p2 -->
                <div class="panel p2">
                    <div class="inner">
                        <p class="title">디자인테이닝의 모든 작업은</p>
                        <p class="title">반응형으로 제작됩니다.</p>
                    </div>
                    <div class="panel_box_wrapper">
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                        <div class="panel_box"><img src="https://ncryk7.mycafe24.com/package1.png" alt=""></div>
                    </div>
                </div>

                <!-- p3: 메시지 → 이미지(70%) → 후속 메시지 -->
                <div class="panel p3">
                    <div class="inner">
                        <p class="title">Step 3 — 비주얼/모션</p>
                        <p class="desc">이미지/영상/3D 등 어떤 콘텐츠든 동일한 방식으로 교체 가능.</p>
                        <div class="featureImgWrap">
                            <img src="https://ncryk7.mycafe24.com/package3.png" alt="feature">
                        </div>
                        <p class="title msg2">메시지 2 — 실제 제작 예시를 확인해 보세요.</p>
                    </div>
                </div>

                <!-- p4 (사진 제거) -->
                <div class="panel p4">
                    <div class="inner">
                        <p class="title">Step 4 — CTA</p>
                        <p class="desc">마지막에서 버튼/링크로 다음 섹션으로 유도하세요.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        const root = document.querySelector("#pinShowcase");
        const frame = root.querySelector(".pinFrame");   // ✅ 축소 대상
        const p1 = root.querySelector(".p1");
        const p2 = root.querySelector(".p2");
        const p3 = root.querySelector(".p3");
        const p4 = root.querySelector(".p4");
        const panels = [p1, p2, p3, p4];

        const heroBox = root.querySelector(".p1 .heroBox");
        const p2Boxes = gsap.utils.toArray(".p2 .panel_box");
        const firstHalf = p2Boxes.slice(0, 4);
        const secondHalf = p2Boxes.slice(4, 8);

        const featureImgWrap = p3.querySelector(".featureImgWrap");
        const msg2 = p3.querySelector(".msg2");

        /* 스크롤 길이 */
        const SCROLL_PER_PANEL = 1100; // 필요 시 조절
        const totalScroll = (panels.length - 1) * SCROLL_PER_PANEL;

        /* 초기 상태 */
        gsap.set(p1, { opacity: 1, y: 0 });
        gsap.set([p2, p3, p4], { opacity: 0, y: 40 });
        gsap.set(p3, { xPercent: 100 });   // p3 오른쪽 대기
        gsap.set(p2, { xPercent: 0 });
        gsap.set(p2Boxes, { y: 40, opacity: 0 });
        gsap.set(featureImgWrap, { opacity: 0, y: 60 });
        gsap.set(msg2, { opacity: 0, y: 30 });

        /* 메인 타임라인 */
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: root,
                start: "top top",
                end: "+=" + totalScroll,
                pin: true,
                scrub: 1,
                anticipatePin: 1,
                snap: {
                    snapTo: (v) => {
                        const steps = panels.length - 1;
                        return Math.round(v * steps) / steps;
                    },
                    duration: 0.15,
                    ease: "power1.out"
                }
            }
        });

        /* 1) p1: heroBox 80vw → 100vw */
        if (heroBox) {
            tl.to(heroBox, {
                width: "100vw",
                height: "100vmin",
                borderRadius: 0,
                ease: "power2.out",
                duration: 0.6
            }, 0);
        }

        /* 2) p1 → p2 */
        tl.to(p1, { opacity: 0, y: -40, duration: 0.5, ease: "power2.out" }, ">")
            .fromTo(p2, { opacity: 0, y: 40 }, { opacity: 1, y: 0, duration: 0.6, ease: "power2.out" }, "<");

        /* 3) p2 박스 8개 스태거 인 */
        tl.fromTo(p2Boxes,
            { y: 40, opacity: 0 },
            { y: 0, opacity: 1, duration: 0.6, ease: "power3.out", stagger: 0.08 },
            "<+=0.1"
        );

        /* 4) p2 → p3 (푸시) */
        tl.add("p2to3", ">+=0.25")
            .to(firstHalf, { y: -160, duration: 0.5, ease: "power3.in" }, "p2to3")
            .to(secondHalf, { y: 160, duration: 0.5, ease: "power3.in" }, "p2to3")
            .to(p2, { xPercent: -100, duration: 0.65, ease: "power2.inOut" }, "p2to3")
            .fromTo(p3, { xPercent: 100, opacity: 1, y: 0 }, { xPercent: 0, opacity: 1, y: 0, duration: 0.65, ease: "power2.inOut" }, "p2to3")
            .set(p2, { opacity: 0 }, ">");

        /* 5) p3 내부: 이미지(70%) 등장 → 후속 메시지 */
        tl.to(featureImgWrap, {
            opacity: 1, y: 0, duration: 0.8, ease: "power3.out"
        }, ">+=0.1"
        ).to(msg2, {
            opacity: 1, y: 0, duration: 0.6, ease: "power3.out"
        }, ">+=0.15"
        );

        /* 6) p3 → p4 */
        tl.to(p3, { opacity: 0, y: -40, duration: 0.5, ease: "power2.out" }, ">+=0.2")
            .fromTo(p4, { opacity: 0, y: 40 }, { opacity: 1, y: 0, duration: 0.6, ease: "power2.out" }, "<");

        /* 7) ✅ 아웃트로: 섹션의 시각적 프레임 자체를 80vw × 80vw로 축소 */
        tl.add("outro", ">+=0.3")
            .to(frame, {
                width: "80vw",
                height: "80vw",
                borderRadius: 24,
                duration: 0.9,
                ease: "power2.inOut",
                transformOrigin: "center center"
            }, "outro");

        /* 팁
         * - frame을 줄이면 내부 패널이 함께 축소되어 '섹션 자체'가 작아지는 느낌을 안정적으로 구현
         * - 더 드라마틱하게 보이게 하려면 ease를 power3.inOut, duration을 1.2 등으로 조절
         */
    </script>

</body>

</html>